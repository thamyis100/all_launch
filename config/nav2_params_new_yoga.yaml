# dwb_nav2.yaml
controller_server:
  ros__parameters:
    use_sim_time: false
    controller_frequency: 15.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.001
    min_theta_velocity_threshold: 0.001
    progress_checker_plugin: "progress_checker"
    goal_checker_plugins: ["general_goal_checker"]
    controller_plugins: ["FollowPath"]

    progress_checker:
      plugin: "nav2_controller::SimpleProgressChecker"
      required_movement_radius: 0.05
      movement_time_allowance: 10.0

    general_goal_checker:
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.3
      yaw_goal_tolerance: 0.3
      stateful: true

    FollowPath:
      plugin: "dwb_core::DWBLocalPlanner"
      debug_trajectory_details: true

      # Holonomic limits (match old working config for omni)
      min_vel_x: -0.6
      min_vel_y: -0.6
      min_vel_theta: -1.0
      max_vel_x: 0.6
      max_vel_y: 0.6
      max_vel_theta: 1.0

      min_speed_xy: 0.0
      max_speed_xy: 0.6
      min_speed_theta: 0.0
      max_speed_theta: 1.0

      # Accels (keep new slightly larger if needed)
      acc_lim_x: 2.0
      acc_lim_y: 2.0
      acc_lim_theta: 1.5
      decel_lim_x: -2.0
      decel_lim_y: -2.0
      decel_lim_theta: -1.5

      # Sampling / sim
      vx_samples: 15
      vy_samples: 41
      vtheta_samples: 15
      sim_time: 1.5
      linear_granularity: 0.025
      angular_granularity: 0.025
      transform_tolerance: 0.2

      xy_goal_tolerance: 0.2
      trans_stopped_velocity: 0.05
      short_circuit_trajectory_evaluation: true
      stateful: true

      # DWB critics â€” restore RotateToGoal and Oscillation like the old working file
      critics: ["RotateToGoal","Oscillation","ObstacleFootprint","GoalAlign","PathAlign","PathDist","GoalDist"]

      ObstacleFootprint.scale: 0.12
      PathAlign.scale: 0.0
      PathAlign.forward_point_distance: 0.08
      PathDist.scale: 0.0
      GoalAlign.scale: 0.0
      GoalAlign.forward_point_distance: 0.08
      GoalDist.scale: 24.0
      RotateToGoal.scale: 0.0
      RotateToGoal.slowing_factor: 4.5
      RotateToGoal.lookahead_time: -1.0
      Oscillation.scale: 0.0
      Oscillation.oscillation_reset_dist: 0.06
      Oscillation.oscillation_reset_angle: 0.15
      Oscillation.oscillation_reset_time: 2.0


planner_server:
  ros__parameters:
    planner_plugins: ["GridBased"]
    GridBased:
      plugin: "nav2_smac_planner/SmacPlanner2D"
      use_holonomic_motion: true
      allow_unknown: true
      costmap_downsampling: 2
      max_iterations: 50000
      # optional: tune these if required for performance
      max_planning_time: 1.0
      allow_initial_traversal: false
